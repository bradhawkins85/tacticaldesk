{% extends "base.html" %}

{% block header_actions %}
  <span class="status-pill {% if installers_enabled %}status-pill--success{% else %}status-pill--warning{% endif %}">
    {% if installers_enabled %}Installers enabled{% else %}Installers locked{% endif %}
  </span>
{% endblock %}

{% block content %}
  <section class="panel">
    <header class="panel__header">
      <div>
        <h2>Installer guardrails</h2>
        <p>Review lock status and deployment guidance before scheduling any platform maintenance.</p>
      </div>
    </header>
    <div class="panel__body">
      <div class="guidance-grid" role="list">
        <article class="guidance-card" role="listitem">
          <h3>Lock enforcement</h3>
          <p>
            Installer lock is currently <strong>{% if installers_enabled %}disabled{% else %}enforced{% endif %}</strong>.
            Toggle the <code>TACTICAL_DESK_ENABLE_INSTALLERS</code> environment variable to change state. Ensure only
            super administrators have shell access to adjust the flag.
          </p>
        </article>
        <article class="guidance-card" role="listitem">
          <h3>Service account hygiene</h3>
          <p>
            Confirm SSH keys and deployment credentials remain scoped to least privilege before unlocking installers. Rotate
            credentials immediately after maintenance to limit exposure.
          </p>
        </article>
        <article class="guidance-card" role="listitem">
          <h3>Audit expectations</h3>
          <p>
            Document every installer toggle in the changelog and retain CLI transcripts for compliance. Failed attempts should
            be reviewed and reported to the security team within 24 hours.
          </p>
        </article>
      </div>
    </div>
    <footer class="panel__footer">
      <p>
        Tactical Desk automatically provisions both production and development services through hardened scripts. Execute them
        via approved CI or shell workflows using the endpoints referenced below.
      </p>
    </footer>
  </section>

  <section class="panel">
    <header class="panel__header">
      <div>
        <h2>Installer runbook references</h2>
        <p>Use authenticated API calls or server-side scripts to trigger these automated runbooks.</p>
      </div>
    </header>
    <div class="panel__body">
      <ul class="runbook-list">
        {% for script in maintenance_scripts %}
        <li class="runbook-item">
          <div class="runbook-summary">
            <h3>{{ script.name }}</h3>
            <p>{{ script.description }}</p>
          </div>
          <code class="runbook-endpoint">POST /maintenance/{{ script.slug }}</code>
        </li>
        {% endfor %}
      </ul>
    </div>
  </section>
{% endblock %}
