{% extends "base.html" %}

{% block header_actions %}
<a class="button" href="{{ url_for('admin_playbook_create') }}">
  <span aria-hidden="true">‚ûï</span>
  <span>Create playbook</span>
</a>
{% endblock %}

{% block content %}
<section class="panel playbook-panel">
  <div class="panel__header">
    <div class="panel__intro">
      <h2 class="panel__title">Playbook catalogue</h2>
      <p class="panel__subtitle">
        Centralise automation playbooks, keep operator notes up to date, and review automation coverage per runbook.
      </p>
    </div>
    <div class="panel__filters">
      <input
        type="search"
        placeholder="Search playbooks"
        aria-label="Search playbooks"
        data-role="table-filter"
      />
    </div>
  </div>
  <div class="table-wrapper">
    <table class="data-table" data-role="sortable-table">
      <thead>
        <tr>
          <th scope="col" data-sort-key="name">Playbook</th>
          <th scope="col" data-sort-key="slug">Slug</th>
          <th scope="col" data-sort-key="automations">Automations</th>
          <th scope="col" data-sort-key="updated">Last updated</th>
          <th scope="col" class="table-actions">Actions</th>
        </tr>
      </thead>
      <tbody data-role="playbook-table-body">
        {% if playbooks %}
        {% for playbook in playbooks %}
        <tr
          data-playbook-row
          data-playbook-id="{{ playbook.id }}"
          data-filter-visible="true"
          data-search-visible="true"
        >
          <th scope="row" data-sort-value="{{ playbook.name|lower }}">
            <div class="playbook-name">
              <span class="playbook-name__title">{{ playbook.name }}</span>
              <p class="playbook-name__description">
                {{ playbook.description or 'No description provided yet.' }}
              </p>
            </div>
          </th>
          <td data-sort-value="{{ playbook.slug }}">
            <code>{{ playbook.slug }}</code>
          </td>
          <td data-sort-value="{{ playbook.automation_count }}">
            <span class="playbook-count">{{ playbook.automation_count }}</span>
          </td>
          <td data-sort-value="{{ playbook.updated_at_iso or '' }}">
            {% if playbook.updated_at_iso %}
            <time data-role="local-datetime" datetime="{{ playbook.updated_at_iso }}">
              {{ playbook.updated_at_iso }}
            </time>
            {% else %}
            <span class="automation-placeholder">‚Äî</span>
            {% endif %}
          </td>
          <td class="table-actions">
            <div class="playbook-actions">
              <a
                class="button button--ghost"
                href="{{ url_for('admin_playbook_edit', playbook_id=playbook.id) }}"
              >
                ‚úèÔ∏è Edit
              </a>
              <button
                type="button"
                class="button button--ghost button--danger"
                data-action="playbook-delete"
                data-playbook-id="{{ playbook.id }}"
                data-playbook-name="{{ playbook.name }}"
              >
                üóë Delete
              </button>
            </div>
          </td>
        </tr>
        {% endfor %}
        {% else %}
        <tr class="playbook-empty">
          <td colspan="5">No playbooks found. Create the first playbook to begin orchestrating automations.</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</section>
{% endblock %}
