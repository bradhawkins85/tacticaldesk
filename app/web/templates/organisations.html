{% extends "base.html" %}

{% block header_actions %}
<a class="button" href="{{ url_for('admin_organization_create') }}">
  <span aria-hidden="true">‚ûï</span>
  <span>Create organisation</span>
</a>
{% endblock %}

{% block content %}
<div class="organization-workspace">
  <section class="panel">
    <div class="panel__header organization-panel__header">
      <div class="panel__intro">
        <h2 class="panel__title">Organisation registry</h2>
        <p class="panel__subtitle">
          Review every tenant, manage onboarding details, and archive inactive organisations without
          losing their historical footprint.
        </p>
      </div>
      <div class="panel__filters">
        <label class="form-field form-field--inline" for="organization-status-filter">
          <span class="form-field__label">Status</span>
          <select id="organization-status-filter" data-role="organization-status-filter">
            <option value="all">All</option>
            <option value="active">Active</option>
            <option value="archived">Archived</option>
          </select>
        </label>
      </div>
    </div>
    <div class="table-actions">
      <input
        type="search"
        placeholder="Search organisations"
        aria-label="Search organisations"
        data-role="table-filter"
      />
    </div>
    <div class="table-wrapper">
      <table class="data-table" data-role="sortable-table" data-organization-table="true">
        <thead>
          <tr>
            <th scope="col" data-sort-key="name">Organisation</th>
            <th scope="col" data-sort-key="contact">Primary contact</th>
            <th scope="col" data-sort-key="status">Status</th>
            <th scope="col" data-sort-key="created">Created</th>
            <th scope="col" data-sort-key="updated">Updated</th>
            <th scope="col" class="table-actions">Actions</th>
          </tr>
        </thead>
        <tbody data-role="organization-table-body">
          {% if organizations %}
          {% for org in organizations %}
          <tr
            data-organization-row
            data-organization='{{ org | tojson }}'
            data-organization-id="{{ org.id }}"
            data-status="{{ 'archived' if org.is_archived else 'active' }}"
            data-filter-visible="true"
            data-search-visible="true"
          >
            <td data-sort-value="{{ org.name|lower }}">
              <div class="organization-name">{{ org.name }}</div>
              <div class="organization-slug">{{ org.slug }}</div>
              {% if org.description %}
              <div class="organization-description">{{ org.description }}</div>
              {% endif %}
            </td>
            <td data-sort-value="{{ org.contact_email or '' }}">
              {% if org.contact_email %}
              <a class="organization-contact" href="mailto:{{ org.contact_email }}">{{ org.contact_email }}</a>
              {% else %}
              <span class="organization-contact organization-contact--empty">Not provided</span>
              {% endif %}
            </td>
            <td data-sort-value="{{ 'archived' if org.is_archived else 'active' }}">
              <span
                class="status-pill {% if org.is_archived %}status-pill--archived{% else %}status-pill--success{% endif %}"
                data-role="organization-status-label"
              >
                {{ 'Archived' if org.is_archived else 'Active' }}
              </span>
            </td>
            <td data-sort-value="{{ org.created_at_iso }}" data-format="datetime">
              {{ org.created_at_iso }}
            </td>
            <td data-sort-value="{{ org.updated_at_iso }}" data-format="datetime">
              {{ org.updated_at_iso }}
            </td>
            <td class="table-actions">
              <div class="organization-actions">
                <a
                  class="button button--ghost"
                  href="{{ url_for('admin_organization_contacts', organization_id=org.id) }}"
                >
                  üë• Contacts
                </a>
                <a
                  class="button button--ghost"
                  href="{{ url_for('admin_organization_edit', organization_id=org.id) }}"
                >
                  ‚úèÔ∏è Edit
                </a>
                <button
                  type="button"
                  class="button button--ghost"
                  data-action="toggle-organization-archive"
                  data-organization-id="{{ org.id }}"
                  data-is-archived="{{ 'true' if org.is_archived else 'false' }}"
                >
                  {{ 'Restore' if org.is_archived else 'Archive' }}
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
          {% else %}
          <tr class="organization-empty">
            <td colspan="6">No organisations found yet. Create the first tenant to get started.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>
</div>

{% endblock %}
