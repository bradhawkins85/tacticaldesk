{% extends "base.html" %}
{% block header_actions %}
<a class="secondary-button" href="{{ url_for('automation') }}">Back to automations</a>
{% endblock %}
{% block content %}
<section
  class="panel automation-editor"
  data-role="automation-edit-page"
  data-automation-id="{{ automation.id }}"
  data-automation-kind="{{ automation.kind }}"
  data-return-url="{{ url_for('automation') }}"
>
  <header class="panel__header">
    <div class="panel__intro">
      <span class="automation-editor__kind">Scheduled automation</span>
      <h2 class="panel__title">{{ automation.name }}</h2>
      <p class="panel__subtitle">
        Configure cron-based execution windows and upcoming run history for this playbook.
      </p>
    </div>
  </header>
  <div class="panel__body">
    <form data-role="automation-edit-form" autocomplete="off">
      <p class="automation-editor__hint">
        Cron expressions run in UTC and render in your local timezone when displayed below.
        {% if cron_reference_url %}
        <a href="{{ cron_reference_url }}" target="_blank" rel="noopener">Cron reference</a>
        {% endif %}
      </p>
      <div class="automation-editor__grid">
        <div class="form-field">
          <label for="automation-name">Name</label>
          <input
            id="automation-name"
            name="name"
            type="text"
            maxlength="255"
            required
            value="{{ automation.name }}"
          />
        </div>
        <div class="form-field">
          <label for="automation-playbook">Playbook</label>
          <input
            id="automation-playbook"
            name="playbook"
            type="text"
            maxlength="255"
            required
            value="{{ automation.playbook }}"
          />
        </div>
        <div class="form-field automation-editor__grid-item--full">
          <label for="automation-description">Description</label>
          <textarea id="automation-description" name="description" rows="4" maxlength="2048">{{ automation.description or '' }}</textarea>
        </div>
        <div class="form-field">
          <label for="automation-cron-expression">Cron expression</label>
          <input
            id="automation-cron-expression"
            name="cron_expression"
            type="text"
            maxlength="255"
            required
            pattern="^\S+(\s+\S+){4,5}$"
            value="{{ automation.cron_expression or '' }}"
            placeholder="0 2 * * *"
          />
          <p class="form-field__hint">Provide five or six cron segments. Example: <code>30 0 * * *</code>.</p>
        </div>
        <div class="form-field">
          <label for="automation-next-run">Next run</label>
          <input
            id="automation-next-run"
            name="next_run_at"
            type="datetime-local"
            step="60"
            data-automation-datetime
            data-iso-value="{{ automation.next_run_iso or '' }}"
          />
        </div>
        <div class="form-field">
          <label for="automation-last-run">Last run</label>
          <input
            id="automation-last-run"
            name="last_run_at"
            type="datetime-local"
            step="60"
            data-automation-datetime
            data-iso-value="{{ automation.last_run_iso or '' }}"
          />
        </div>
      </div>
      <div class="automation-editor__message" data-role="automation-message" role="status" aria-live="polite"></div>
      <div class="automation-editor__actions">
        <a class="secondary-button" href="{{ url_for('automation') }}">Cancel</a>
        <button class="primary-button" type="submit" data-role="automation-submit">Save changes</button>
      </div>
    </form>
  </div>
</section>
{% endblock %}
